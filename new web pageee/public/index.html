<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updated Guidelines Medicine Source - Dr. Mohamed Magdy</title>
    <meta name="description" content="Comprehensive medical guidelines from WHO, CDC, NICE, AHA, ADA, IDSA and more. Powered by Dr. Mohamed Magdy">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../src/index.css">
</head>
<body>
    <!-- Background Elements -->
    <div class="medical-bg">
        <div class="medical-element">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#3b82f6" stroke-width="2" fill="none"/>
                <path d="M2 17L12 22L22 17" stroke="#3b82f6" stroke-width="2" fill="none"/>
                <path d="M2 12L12 17L22 12" stroke="#3b82f6" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="medical-element">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#8b5cf6" stroke-width="2" fill="none"/>
                <path d="M2 17L12 22L22 17" stroke="#8b5cf6" stroke-width="2" fill="none"/>
                <path d="M2 12L12 17L22 12" stroke="#8b5cf6" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="medical-element">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#10b981" stroke-width="2" fill="none"/>
                <path d="M2 17L12 22L22 17" stroke="#10b981" stroke-width="2" fill="none"/>
                <path d="M2 12L12 17L22 12" stroke="#10b981" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="medical-element">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#f59e0b" stroke-width="2" fill="none"/>
                <path d="M2 17L12 22L22 17" stroke="#f59e0b" stroke-width="2" fill="none"/>
                <path d="M2 12L12 17L22 12" stroke="#f59e0b" stroke-width="2" fill="none"/>
            </svg>
        </div>
        <div class="medical-element">
            <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#ef4444" stroke-width="2" fill="none"/>
                <path d="M2 17L12 22L22 17" stroke="#ef4444" stroke-width="2" fill="none"/>
                <path d="M2 12L12 17L22 12" stroke="#ef4444" stroke-width="2" fill="none"/>
            </svg>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <span class="org-logo">üè•</span>
                </div>
                <div>
                    <h1 class="logo-text">Updated Guidelines Medicine Source</h1>
                    <p class="text-text-secondary">Powered by <span class="footer-doctor">Dr. Mohamed Magdy</span></p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <span class="text-text-secondary">Last Updated: <span class="text-success font-semibold">Live</span></span>
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-container">
            <div class="search-bar">
                <input
                    type="text"
                    id="search-input"
                    class="search-input"
                    placeholder="Search across 50+ medical organizations (e.g., 'diabetes management', 'cardiology guidelines', 'COVID-19 treatment')..."
                />
                <button id="ai-summarize-btn" class="ai-summarize-btn">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                    AI Summarize
                </button>
                <button id="search-btn" class="search-btn">
                    Search
                </button>
            </div>
            
            <!-- Search Sources with Logos -->
            <div class="filter-section">
                <span class="text-text-secondary font-medium">Searching:</span>
                <span class="filter-btn">
                    <span class="org-logo logo-who"></span>WHO
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-cdc"></span>CDC
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-nice"></span>NICE
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-aha"></span>AHA
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-ada"></span>ADA
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-idsa"></span>IDSA
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-acog"></span>ACOG
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-acp"></span>ACP
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-asco"></span>ASCO
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-acr"></span>ACR
                </span>
                <span class="filter-btn">
                    <span class="org-logo logo-nih"></span>NIH
                </span>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Sidebar -->
        <aside class="sidebar">
            <h3>Filters</h3>
            
            <div class="filter-group">
                <label for="organization-filter">Organization</label>
                <select id="organization-filter" class="filter-select">
                    <option value="">All Organizations</option>
                    <option value="WHO">WHO</option>
                    <option value="CDC">CDC</option>
                    <option value="NICE">NICE</option>
                    <option value="AHA">AHA</option>
                    <option value="ADA">ADA</option>
                    <option value="IDSA">IDSA</option>
                    <option value="ACOG">ACOG</option>
                    <option value="ACP">ACP</option>
                    <option value="ASCO">ASCO</option>
                    <option value="ACR">ACR</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="specialty-filter">Specialty</label>
                <select id="specialty-filter" class="filter-select">
                    <option value="">All Specialties</option>
                    <option value="Cardiology">Cardiology</option>
                    <option value="Endocrinology">Endocrinology</option>
                    <option value="Infectious Disease">Infectious Disease</option>
                    <option value="Oncology">Oncology</option>
                    <option value="Pediatrics">Pediatrics</option>
                    <option value="Emergency Medicine">Emergency Medicine</option>
                    <option value="Internal Medicine">Internal Medicine</option>
                    <option value="Surgery">Surgery</option>
                    <option value="Psychiatry">Psychiatry</option>
                    <option value="Neurology">Neurology</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="year-filter">Year</label>
                <select id="year-filter" class="filter-select">
                    <option value="">All Years</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                    <option value="2022">2022</option>
                    <option value="2021">2021</option>
                    <option value="2020">2020</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="date-range">Date Range</label>
                <input type="date" id="date-range" class="filter-input">
            </div>
        </aside>

        <!-- Guidelines Grid -->
        <div class="guidelines-container">
            <div id="guidelines-grid" class="guidelines-grid">
                <!-- Guidelines will be dynamically inserted here -->
            </div>
            
            <!-- AI Summary Section -->
            <div id="ai-summary-section" style="display: none;">
                <div class="ai-summary-header">
                    <div class="ai-summary-icon">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <h2 class="ai-summary-title">AI Summary</h2>
                </div>
                <div id="ai-summary-content">
                    <!-- AI summary content will be inserted here -->
                </div>
                <div class="ai-summary-meta">
                    <div class="ai-summary-model">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        <span class="text-xs text-text-secondary">Generated by Qwen 3.5 AI Model</span>
                    </div>
                    <span class="text-xs text-text-secondary">${new Date().toLocaleString()}</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p class="footer-text">
                <span class="footer-brand">Updated Guidelines Medicine Source</span> - 
                Comprehensive medical guidelines from leading organizations worldwide
            </p>
            <p class="footer-text">
                Powered by <span class="footer-doctor">Dr. Mohamed Magdy</span> | 
                Real-time AI-powered medical guideline aggregation
            </p>
        </div>
    </footer>

    <script>
        // Sample data for demonstration
        const sampleGuidelines = [
            {
                id: 1,
                title: "Management of Type 2 Diabetes in Adults",
                source: "ADA",
                date: "2024-01-15",
                link: "https://diabetesjournals.org/care/issue?guideline=diabetes-management-2024",
                summary: "Comprehensive guidelines for the management of type 2 diabetes including lifestyle modifications, pharmacotherapy, and monitoring strategies.",
                tags: ["Endocrinology", "Diabetes", "Primary Care"]
            },
            {
                id: 2,
                title: "COVID-19 Treatment Guidelines",
                source: "WHO",
                date: "2024-01-10",
                link: "https://www.who.int/publications/guidelines?guideline=covid19-treatment-2024",
                summary: "Updated treatment protocols for COVID-19 including antiviral therapies, supportive care, and prevention strategies.",
                tags: ["Infectious Disease", "COVID-19", "Emergency Medicine"]
            },
            {
                id: 3,
                title: "Cardiovascular Disease Prevention",
                source: "AHA",
                date: "2024-01-08",
                link: "https://www.heart.org/en/professional/quality-improvement/clinical-guidance?guideline=cvd-prevention-2024",
                summary: "Evidence-based recommendations for cardiovascular disease prevention through lifestyle modifications and risk factor management.",
                tags: ["Cardiology", "Prevention", "Primary Care"]
            },
            {
                id: 4,
                title: "Antimicrobial Stewardship in Hospitals",
                source: "IDSA",
                date: "2024-01-05",
                link: "https://www.idsociety.org/practice-guideline?guideline=antimicrobial-stewardship-2024",
                summary: "Guidelines for implementing antimicrobial stewardship programs to combat antibiotic resistance in healthcare settings.",
                tags: ["Infectious Disease", "Antimicrobial", "Hospital Medicine"]
            },
            {
                id: 5,
                title: "Breast Cancer Screening and Diagnosis",
                source: "ASCO",
                date: "2024-01-03",
                link: "https://www.asco.org/practice-patients/guidelines?guideline=breast-cancer-screening-2024",
                summary: "Updated screening and diagnostic protocols for breast cancer including imaging modalities and biopsy techniques.",
                tags: ["Oncology", "Breast Cancer", "Radiology"]
            },
            {
                id: 6,
                title: "Hypertension Management in Adults",
                source: "NICE",
                date: "2024-01-01",
                link: "https://www.nice.org.uk/guidance/published?guideline=hypertension-management-2024",
                summary: "Comprehensive guidelines for the diagnosis, treatment, and monitoring of hypertension in adult patients.",
                tags: ["Cardiology", "Hypertension", "Primary Care"]
            }
        ];

        // DOM elements
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const aiSummarizeBtn = document.getElementById('ai-summarize-btn');
        const guidelinesGrid = document.getElementById('guidelines-grid');
        const aiSummarySection = document.getElementById('ai-summary-section');
        const aiSummaryContent = document.getElementById('ai-summary-content');
        const organizationFilter = document.getElementById('organization-filter');
        const specialtyFilter = document.getElementById('specialty-filter');
        const yearFilter = document.getElementById('year-filter');

        // OpenRouter API configuration
        let openRouterApiKey = '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';

        // Initialize the application
        function init() {
            renderGuidelines(sampleGuidelines);
            setupEventListeners();
            updateLastUpdated();
        }

        // Render guidelines
        function renderGuidelines(guidelines) {
            guidelinesGrid.innerHTML = '';
            
            if (guidelines.length === 0) {
                guidelinesGrid.innerHTML = `
                    <div class="guideline-card" style="grid-column: 1 / -1; text-align: center;">
                        <h3 class="card-title">No guidelines found</h3>
                        <p class="card-summary">Try adjusting your search terms or filters.</p>
                    </div>
                `;
                return;
            }

            guidelines.forEach(guideline => {
                const card = createGuidelineCard(guideline);
                guidelinesGrid.appendChild(card);
            });
        }

        // Create guideline card
        function createGuidelineCard(guideline) {
            const card = document.createElement('div');
            card.className = 'guideline-card';
            card.innerHTML = `
                <div class="card-header">
                    <div>
                        <h3 class="card-title">${guideline.title}</h3>
                        <span class="source-badge">${guideline.source}</span>
                    </div>
                </div>
                <div class="card-date">${formatDate(guideline.date)}</div>
                <div class="card-summary">${guideline.summary}</div>
                <div class="card-actions">
                    <a href="${guideline.link}" target="_blank" class="card-btn">Read Full</a>
                    <button class="card-btn ai-summarize-single" onclick="summarizeSingleGuideline('${guideline.title}', '${guideline.summary}')">
                        AI Summary
                    </button>
                </div>
            `;
            return card;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
            
            aiSummarizeBtn.addEventListener('click', summarizeAllGuidelines);
            
            organizationFilter.addEventListener('change', applyFilters);
            specialtyFilter.addEventListener('change', applyFilters);
            yearFilter.addEventListener('change', applyFilters);
        }

        // Perform search
        function performSearch() {
            const query = searchInput.value.trim();
            if (!query) {
                renderGuidelines(sampleGuidelines);
                return;
            }

            const filteredGuidelines = sampleGuidelines.filter(guideline => 
                guideline.title.toLowerCase().includes(query.toLowerCase()) ||
                guideline.summary.toLowerCase().includes(query.toLowerCase()) ||
                guideline.tags.some(tag => tag.toLowerCase().includes(query.toLowerCase()))
            );

            renderGuidelines(filteredGuidelines);
        }

        // Apply filters
        function applyFilters() {
            const organization = organizationFilter.value;
            const specialty = specialtyFilter.value;
            const year = yearFilter.value;

            let filteredGuidelines = sampleGuidelines;

            if (organization) {
                filteredGuidelines = filteredGuidelines.filter(g => g.source === organization);
            }

            if (specialty) {
                filteredGuidelines = filteredGuidelines.filter(g => 
                    g.tags.some(tag => tag === specialty)
                );
            }

            if (year) {
                filteredGuidelines = filteredGuidelines.filter(g => 
                    g.date.startsWith(year)
                );
            }

            renderGuidelines(filteredGuidelines);
        }

        // Summarize all guidelines
        async function summarizeAllGuidelines() {
            const visibleGuidelines = Array.from(guidelinesGrid.children)
                .map(card => ({
                    title: card.querySelector('.card-title').textContent,
                    summary: card.querySelector('.card-summary').textContent
                }));

            if (visibleGuidelines.length === 0) {
                alert('No guidelines to summarize. Please perform a search first.');
                return;
            }

            const prompt = `Please provide a comprehensive AI summary of the following medical guidelines. Structure your response with clear headings and bullet points:

${visibleGuidelines.map(g => `- ${g.title}: ${g.summary}`).join('\n')}

Please provide a professional summary with the following structure:
1. Executive Summary
2. Key Recommendations
3. Clinical Implications
4. Implementation Considerations

Make the summary clear, concise, and clinically relevant.`;

            await callOpenRouterAPI(prompt, 'all');
        }

        // Summarize single guideline
        async function summarizeSingleGuideline(title, summary) {
            const prompt = `Please provide a detailed AI summary of the following medical guideline:

Title: ${title}
Summary: ${summary}

Please provide a professional summary with the following structure:
1. Clinical Overview
2. Key Recommendations
3. Evidence Base
4. Practical Implementation
5. Clinical Pearls

Make the summary clear, concise, and clinically relevant.`;

            await callOpenRouterAPI(prompt, 'single');
        }

        // Call OpenRouter API
        async function callOpenRouterAPI(prompt, type) {
            try {
                // Show loading state
                if (type === 'all') {
                    aiSummarySection.style.display = 'block';
                    aiSummaryContent.innerHTML = `
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                        <p>Generating AI summary...</p>
                    `;
                } else {
                    aiSummarySection.style.display = 'block';
                    aiSummaryContent.innerHTML = `
                        <div class="loading-dots">
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                            <div class="loading-dot"></div>
                        </div>
                        <p>Generating AI summary for: ${type === 'single' ? 'selected guideline' : 'all guidelines'}...</p>
                    `;
                }

                // Scroll to summary section
                aiSummarySection.scrollIntoView({ behavior: 'smooth' });

                const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openRouterApiKey}`,
                        'HTTP-Referer': 'https://medical-guideline-aggregator.vercel.app/',
                        'X-Title': 'https://medical-guideline-aggregator.vercel.app/'
                    },
                    body: JSON.stringify({
                        model: 'qwen/qwen3-30b-a3b',
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} - ${response.statusText}`);
                }

                const data = await response.json();
                const summary = data.choices[0].message.content;

                // Display the summary
                aiSummaryContent.innerHTML = `
                    <div class="ai-summary-content">
                        ${summary.replace(/\n/g, '<br>')}
                    </div>
                `;

                // Update timestamp
                const timestamp = document.querySelector('.ai-summary-timestamp');
                if (timestamp) {
                    timestamp.textContent = new Date().toLocaleString();
                }

            } catch (error) {
                console.error('AI summarization failed:', error);
                aiSummaryContent.innerHTML = `
                    <div style="color: #f59e0b; text-align: center; padding: 2rem;">
                        <h4>AI Summary Unavailable</h4>
                        <p>AI summarization failed: ${error.message}</p>
                        <p>Please try again later or contact support if the issue persists.</p>
                    </div>
                `;
            }
        }

        // Update last updated timestamp
        function updateLastUpdated() {
            const now = new Date();
            const lastUpdated = document.querySelector('.text-success');
            if (lastUpdated) {
                lastUpdated.textContent = now.toLocaleTimeString();
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', init);

        // Update timestamp every minute
        setInterval(updateLastUpdated, 60000);
    </script>
</body>
</html>
